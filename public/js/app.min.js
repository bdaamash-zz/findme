var socket=io.connect("http://127.0.0.1:3000/"),app=app||{};$(function(){function getMarker(lat,lng,label){return new google.maps.Marker({title:label,map:map,position:new google.maps.LatLng(lat,lng)})}function updateUserMarker(data){console.log(data),userMarker=getMarker(data.lat,data.lng,data.username),markers[data.key]=userMarker,map.setCenter(markers[data.key].getPosition());var contentString="<b>Username: </b>"+data.username;google.maps.event.addListener(userMarker,"click",function(){infowindow.setContent(contentString),infowindow.open(map,markers[data.key])})}function removeMarker(data){markers[data.key].setMap(null),delete markers[data.key]}function showPosition(position){var username=$(".username").val();if(""==username)return void alert("username can not be empty");var data={lat:position.coords.latitude,lng:position.coords.longitude,username:username};socket.emit("join",data),socket.emit("send location",data)}var $sendBlastButton=$("#send");if("object"==typeof google&&"object"==typeof google.maps){var userMarker,map,infowindow=($("#mapCanvas"),new google.maps.InfoWindow({})),markers={},defaultPosition=new google.maps.LatLng(39.833333,-98.583333),mapOptions={zoom:4,center:defaultPosition,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("mapCanvas"),mapOptions),socket.on("location update",updateUserMarker),socket.on("user disconnected",removeMarker)}$sendBlastButton.click(function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(showPosition)}),$("#locate_newyork").click(function(){var username=$(".username").val();if(""==username)return void alert("username can not be empty");var data={lat:40.7056308,lng:-73.9780035,username:username};socket.emit("join",data),socket.emit("send location",data)}),socket.on("online users",function(data){$(".user_counter").html(data.counter)})});